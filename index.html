<!DOCTYPE html>
<html>
<head>
  <title>kpop sudoku</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .table { display: grid; grid-template-columns: 200px repeat(3, 200px); grid-auto-rows: 50px; gap: 5px; margin-bottom: 20px;}
    .cell { display: flex; justify-content: center; align-items: center; }
    select { width: 90%; height: 90%; font-size: 14px; }
    .highlight { background-color: #a0e7a0; } /* green */
    .wrong { background-color: #e0e0e0; }     /* gray */
    .cat { font-weight: bold; text-align: center; }
    button { padding: 10px 20px; font-size: 16px; margin-right: 10px; }
  </style>
</head>
<body>

<h2>kpop sudoku</h2>

<div>
  <button onclick="generateAndBuildPuzzle()">New Puzzle</button>
  <button onclick="checkGrid()">Check Answers</button>
</div>

<div class="table" id="grid"></div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// === Data ===
const categories = {1:'Girl Group',2:'Boy Group',3:'Currently <7 members',4:'7-9 members',5:'10+ members',
6:'From survival show',7:'Member in multiple groups',8:'Has member named Jimin',9:'Has member named Chaeyoung',
10:'Has member named Jiwoo',11:'Has member named Chaewon',12:'Has survival show non-debuter',
13:'Not under Big 4',14:'Under Big 4',15:'HYBE Group',16:'SM Group',17:'JYPE Group',18:'YG Group',
19:'Lost member',20:'Added member',21:'2nd gen',22:'3rd gen',23:'4th gen',24:'5th gen',25:'Has American member',
26:'Has Australian member',27:'Has Filipino member',28:'Has Japanese member',29:'Has Chinese member',
30:'Has Taiwanese member',31:'Has Thai member',32:'Has Canadian member',33:'Has mixed member',
34:'Has white member',35:'Has Indian member',36:'Has Indonesian member',37:'2010 maknae',38:'2009 maknae',
39:'2008 maknae',40:'Kids show collab',41:'Has IOI member',42:'Has IZ*ONE member',43:'Has Vietnamese member',
44:'Members same real name',45:'Disbanded'};

const groups = {
'Select':[], 'TripleS':[1,5,7,10,11,12,13,20,24,28,29,30,33,37,43,44],'TWICE':[1,4,6,9,12,14,17,22,25,28,30],
'LE SSERAFIM':[1,3,7,12,14,15,19,23,25,42],'BABYMONSTER':[1,4,14,18,24,28,31,38],'Aespa':[1,3,8,14,16,23,25,28,29],
'ILLIT':[1,3,6,12,14,15,24,28,39],'ITZY':[1,3,12,14,17,23,32],'Red Velvet':[1,3,14,16,20,22,32],
'(G)I-DLE':[1,3,12,13,19,23,29,30,31],'IVE':[1,3,7,13,23,28,42],'NMIXX':[1,3,10,14,17,19,23,26,33,34,40],
'KATSEYE':[1,3,6,13,15,24,25,27,29,33,34,35],'MAMAMOO':[1,3,13,22],'NewJeans':[1,3,14,15,19,23,26,43],
'STAYC':[1,3,23],'KISS OF LIFE':[1,3,12,13,24,25,31],'Girls\' Generation':[1,4,14,16,19,21,25],'2NE1':[1,3,14,18,21],
'MEOVV':[1,3,13,24,25,28,33,34],'VIVIZ':[1,3,7,13,23,44],'HEARTS2HEARTS':[1,4,10,14,16,24,36,37],'IZNA':[1,3,6,19,24,28,39],
'ALLDAY PROJECT':[3,12,24,25],'GFRIEND':[1,3,22,44,45],'f(x)':[1,3,14,16,22,25,29],'T-ARA':[1,3,13,19,21],
'Apink':[1,3,19],'LOOSSEMBLE':[1,3,7,11,12,13,24,29],'ARTMS':[1,3,7,12,13,24],'Kep1er':[1,4,6,7,12,13,19,23,25,28,29,33,34,40],
'MADEIN':[1,4,7,12,13,19,24,28],'UNIS':[1,4,6,7,13,24,27,26,33],'KiiiKiii':[1,3,13,24,37],'Say My Name':[1,4,7,12,13,20,24,28,29,31,37,42],
'LOONA':[1,5,7,11,12,13,19,23,29,45],'IZ*ONE':[1,5,6,7,13,23,28,42]
};

// === Helpers ===
function randomSample(array,n){ const copy=[...array]; const res=[]; for(let i=0;i<n;i++){ const idx=Math.floor(Math.random()*copy.length); res.push(copy.splice(idx,1)[0]);} return res;}

let puzzle,rowCats,colCats,dropdowns=[];

function generatePuzzle(){
  const catKeys = Object.keys(categories).map(x=>parseInt(x));
  let attempts = 0;
  while(attempts < 500){
    attempts++;
    rowCats = randomSample(catKeys,3);
    colCats = randomSample(catKeys,3);

    // Prevent any overlap between row and column categories
    if(rowCats.some(r => colCats.includes(r))) continue;

    const cellOptions=[]; let valid=true;
    for(let r=0;r<3;r++){
      for(let c=0;c<3;c++){
        const candidates = Object.keys(groups).filter(g=>groups[g].includes(rowCats[r]) && groups[g].includes(colCats[c]));
        if(candidates.length===0){ valid=false; break;}
        cellOptions.push(candidates);
      }
      if(!valid) break;
    }
    if(!valid) continue;

    // Backtracking to assign 9 unique groups
    puzzle = Array(3).fill(0).map(()=>Array(3).fill(''));
    const used = new Set();
    function assignCell(idx){
      if(idx===9) return true;
      const r=Math.floor(idx/3), c=idx%3;
      const candidates = cellOptions[idx].filter(g=>!used.has(g));
      for(const g of candidates){
        puzzle[r][c]=g; used.add(g);
        if(assignCell(idx+1)) return true;
        used.delete(g); puzzle[r][c]='';
      }
      return false;
    }
    if(assignCell(0)) return; // success
  }
  console.error("Failed to generate puzzle after 500 attempts. Try reducing category set.");
}

// === Build Table ===
function generateAndBuildPuzzle(){
  generatePuzzle();
  const gridDiv = document.getElementById("grid");
  gridDiv.innerHTML=''; dropdowns=[];
  
  // Empty top-left
  gridDiv.appendChild(document.createElement('div'));
  // Column cats
  for(let c=0;c<3;c++){ const div=document.createElement('div'); div.className='cell cat'; div.innerText=categories[colCats[c]]; gridDiv.appendChild(div);}
  
  for(let r=0;r<3;r++){
    dropdowns[r]=[];
    // Row cat
    const div=document.createElement('div'); div.className='cell cat'; div.innerText=categories[rowCats[r]]; gridDiv.appendChild(div);
    for(let c=0;c<3;c++){
      const sel=document.createElement('select');
      sel.dataset.row=r; sel.dataset.col=c;
      Object.keys(groups).forEach(g=>{ const opt=document.createElement('option'); opt.value=g; opt.innerText=g; sel.appendChild(opt);});
      sel.addEventListener('change', enforceNoRepeats);
      dropdowns[r][c]=sel;
      const cellDiv=document.createElement('div'); cellDiv.className='cell'; cellDiv.appendChild(sel); gridDiv.appendChild(cellDiv);
    }
  }
  enforceNoRepeats(); // initialize disabled options
  console.log("Puzzle generated! Row cats:", rowCats.map(r=>categories[r]), "Col cats:", colCats.map(c=>categories[c]));
}

// === No repeats logic ===
function enforceNoRepeats(){
  const used = new Set();
  dropdowns.flat().forEach(sel=>{ if(sel.value) used.add(sel.value); });
  dropdowns.flat().forEach(sel=>{
    Array.from(sel.options).forEach(opt=>{
      if(used.has(opt.value) && opt.value!==sel.value) opt.disabled=true;
      else opt.disabled=false;
    });
  });
}

// === Check Answers & Confetti ===
function checkGrid(){
  let allCorrect=true;
  for(let r=0;r<3;r++){
    for(let c=0;c<3;c++){
      const val=dropdowns[r][c].value;
      const sel=dropdowns[r][c];
      if(groups[val].includes(rowCats[r]) && groups[val].includes(colCats[c])){
        sel.classList.add('highlight'); sel.classList.remove('wrong');
      }else{
        sel.classList.add('wrong'); sel.classList.remove('highlight');
        allCorrect=false;
      }
    }
  }
  if(allCorrect) confetti({particleCount:150, spread:70, origin:{y:0.6}});
}

// === Init ===
generateAndBuildPuzzle();
</script>

</body>
</html>
